{"version":3,"sources":["pages/Upload.js"],"names":["Load","styled","div","Tooltips","Image","img","Result","Dragger","Upload","Component","observer","useStores","ImageStore","UserStore","ref1","useRef","ref2","store","useLocalStore","width","setWidth","height","setHeight","serverFile","attributes","url","widthStr","heightStr","props","showUploadList","beforeUpload","file","setFile","setFilename","name","currentUser","message","warning","upload","then","console","log","catch","error","tip","spinning","isUploading","className","target","href","filename","src","ref","onChange","current","value","placeholder","fullStr"],"mappings":"0vBAQA,IAAMA,EAAOC,IAAOC,IAAV,KAIJC,EAAWF,IAAOC,IAAV,KAORE,EAAQH,IAAOI,IAAV,KAGLC,EAASL,IAAOC,IAAV,KAMLK,EAAWC,IAAXD,QAEDE,EAAYC,aAAS,WAAO,IAAD,EACGC,cAA1BC,EADuB,EACvBA,WAAYC,EADW,EACXA,UACdC,EAAOC,mBACPC,EAAOD,mBAEPE,EAAQC,aAAc,iBAAK,CAC/BC,MAAO,KACPC,SAF+B,SAEtBD,GACPF,EAAME,MAAQA,GAEhB,eACE,OAAOF,EAAME,MAAN,aAAkBF,EAAME,OAAQ,IAGzCE,OAAQ,KACRC,UAV+B,SAUrBD,GACRJ,EAAMI,OAASA,GAEjB,gBACE,OAAOJ,EAAMI,OAAN,aAAmBJ,EAAMI,QAAS,IAE3C,cAEE,OAAOT,EAAWW,WAAWC,WAAWC,IAAID,WAAWC,IAAM,gBAAkBR,EAAMS,SAAWT,EAAMU,eAWpGC,EAAQ,CACZC,gBAAgB,EAChBC,aAAc,SAAAC,GAGZ,OAFAnB,EAAWoB,QAAQD,GACnBnB,EAAWqB,YAAYF,EAAKG,MACC,OAA1BrB,EAAUsB,aACXC,IAAQC,QAAQ,6BACT,IAGTzB,EAAW0B,SACRC,MAAK,SAAChB,GACLiB,QAAQC,IAAI,4BACZD,QAAQC,IAAIlB,MACXmB,OAAM,SAACC,GACRH,QAAQG,MAAMA,EAAMP,aACjB,KAKX,OACE,oCACC,kBAACjC,EAAD,KAECU,EAAUsB,YAAa,KAAO,kFAG9B,kBAACnC,EAAD,KACE,kBAAC,IAAD,CAAM4C,IAAI,qBAAMC,SAAUjC,EAAWkC,aACrC,kBAACvC,EAAYqB,EACX,uBAAGmB,UAAU,wBACX,kBAAC,IAAD,OAEF,uBAAGA,UAAU,mBAAb,gEACA,uBAAGA,UAAU,mBAAb,8DAOAnC,EAAWW,WAAY,kBAACjB,EAAD,KACvB,wDACA,4BACA,wDACI,4BAAI,uBAAG0C,OAAO,SAASC,KAAMrC,EAAWW,WAAWC,WAAWC,IAAID,WAAWC,KAC1Eb,EAAWW,WAAWC,WAAWC,IAAID,WAAWC,MACnD,kDACA,4BAAKb,EAAWsC,UAChB,wDACA,4BACE,kBAAC9C,EAAD,CAAO+C,IAAKvC,EAAWW,WAAWC,WAAWC,IAAID,WAAWC,OAE9D,8DAGA,4BACA,2BAAO2B,IAAKtC,EAAMuC,SAjEN,WACtBpC,EAAMG,SAASN,EAAKwC,QAAQC,QAgE2BC,YAAY,qDACzD,2BAAOJ,IAAKpC,EAAMqC,SA9DL,WACvBpC,EAAMK,UAAUN,EAAKsC,QAAQC,QA6D2BC,YAAY,sDAE1D,4BACE,uBAAIR,OAAO,SAASC,KAAMhC,EAAMwC,SAAUxC,EAAMwC,YAG5C,SAOLhD","file":"static/js/13.e0680a63.chunk.js","sourcesContent":["import React, { useRef } from 'react';\r\nimport { Upload, message, Spin } from 'antd';\r\nimport { InboxOutlined } from '@ant-design/icons';\r\nimport { useStores } from '../stores';\r\nimport styled from 'styled-components';\r\nimport { observer, useLocalStore } from 'mobx-react';\r\n\r\n\r\nconst Load = styled.div`\r\n  margin: 20px auto;\r\n  max-width: 900px;\r\n`;\r\nconst Tooltips = styled.div`\r\n  margin: 20px auto;\r\n  max-width: 900px;\r\n  background: #ff5500;\r\n  text-align: center;\r\n  font-size: 18px;\r\n`\r\nconst Image = styled.img`\r\n  max-width: 300px;\r\n`;\r\nconst Result = styled.div`\r\n  margin: 50px auto;\r\n  max-width: 900px;\r\n  padding: 20px 100px;\r\n  border: 1px dashed #ccc;\r\n`;\r\nconst {Dragger} = Upload;\r\n\r\nconst Component = observer(() => {\r\n  const { ImageStore, UserStore } = useStores();\r\n  const ref1 = useRef();\r\n  const ref2 = useRef();\r\n\r\n  const store = useLocalStore(()=>({\r\n    width: null,\r\n    setWidth(width) {\r\n      store.width = width\r\n    },\r\n    get widthStr() {\r\n      return store.width?`/w/${store.width}`:'';\r\n    },\r\n\r\n    height: null,\r\n    setHeight(height) {\r\n      store.height = height\r\n    },\r\n    get heightStr() {\r\n      return store.height?`/h/${store.height}`:'';\r\n    },\r\n    get fullStr() {\r\n      //?imageView2/0/w/800/h/400)\r\n      return ImageStore.serverFile.attributes.url.attributes.url + '?imageView2/0' + store.widthStr + store.heightStr\r\n    }\r\n  }));\r\n\r\n  const bindWidthChange = () => {\r\n    store.setWidth(ref1.current.value);\r\n  };\r\n\r\n  const bindHeightChange = () => {\r\n    store.setHeight(ref2.current.value);\r\n  };\r\n  const props = {\r\n    showUploadList: false,\r\n    beforeUpload: file => {\r\n      ImageStore.setFile(file);\r\n      ImageStore.setFilename(file.name);\r\n      if(UserStore.currentUser === null){\r\n        message.warning('请先登录')\r\n        return false\r\n      };\r\n      \r\n      ImageStore.upload()\r\n        .then((serverFile) => {\r\n          console.log('上传成功')\r\n          console.log(serverFile);\r\n        }).catch((error) => {\r\n          console.error(error.message);});\r\n      return false;\r\n    },\r\n  };\r\n    \r\n    \r\n  return (\r\n    <>\r\n     <Tooltips>\r\n     {\r\n      UserStore.currentUser? null : <div>请登录后再上传！</div>\r\n    }\r\n     </Tooltips>\r\n      <Load>\r\n        <Spin tip=\"上传中\" spinning={ImageStore.isUploading}>\r\n        <Dragger {...props}>\r\n          <p className=\"ant-upload-drag-icon\">\r\n            <InboxOutlined />\r\n          </p>\r\n          <p className=\"ant-upload-text\">请点击或拖拽上传图品</p>\r\n          <p className=\"ant-upload-hint\">\r\n            支持.png/.jpg/.svg/.gif图片格式\r\n          </p>\r\n        </Dragger>\r\n        </Spin>\r\n      </Load>\r\n        {\r\n          ImageStore.serverFile? <Result>\r\n          <h2>上传结果</h2>\r\n          <dl>\r\n          <dt>线上地址</dt>\r\n              <dd><a target=\"_blank\" href={ImageStore.serverFile.attributes.url.attributes.url}>\r\n                {ImageStore.serverFile.attributes.url.attributes.url}</a></dd>\r\n              <dt>文件名</dt>\r\n              <dd>{ImageStore.filename}</dd>\r\n              <dt>图片预览</dt>\r\n              <dd>\r\n                <Image src={ImageStore.serverFile.attributes.url.attributes.url}/>\r\n              </dd>\r\n              <dt>\r\n                自定义尺寸\r\n              </dt>\r\n              <dd>\r\n              <input ref={ref1} onChange={bindWidthChange} placeholder=\"最大宽度（可选）\"/>\r\n              <input ref={ref2} onChange={bindHeightChange} placeholder=\"最大高度（可选）\"/>\r\n              </dd>\r\n              <dd>\r\n                <a  target=\"_blank\" href={store.fullStr}>{store.fullStr}</a>\r\n              </dd>\r\n          </dl>\r\n        </Result> : null \r\n        }\r\n    </>\r\n \r\n  )\r\n})\r\n\r\nexport default Component;"],"sourceRoot":""}